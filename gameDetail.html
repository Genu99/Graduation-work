<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게임 상세 - Game Forge</title>
    <link rel="stylesheet" href="game.css">
</head>
<body>
    <header>
        <div class="top-nav">
            <div class="logo">
                <a href="main.html">Game Forge</a> <!-- main 페이지로 이동 -->
            </div>
            <nav>
                <ul class="main-menu">
                    <li><a href="store.html">상점</a></li>
                    <li><a href="mypage.html">마이페이지</a></li>
                    <li><a href="community.html">자유게시판</a></li>
                    <li><a href="support.html">지원</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <a href="login.html" class="login-btn">로그인</a>
            </div>
        </div>
    </header>

    <main>
        <div class="game-header">
            <div class="game-title">
                <h1 id="gameName">게임 이름</h1>
                <p id="gameCategory">카테고리: </p>
            </div>
        </div>

        <div class="game-content">
            <div class="game-left">
                <div class="game-screenshots">
                    <img id="gameImage" src="" alt="게임 스크린샷">
                </div>
                <div class="game-description">
                    <p id="gameDescription">게임 설명이 여기에 표시됩니다.</p>
                    <p id="releaseDate">출시일: </p>
                    <p id="publisher">배급사: </p>
                </div>
            </div>

            <div class="game-right">
                <div class="game-info">
                    <p id="priceInfo">가격 정보가 여기에 표시됩니다.</p>
                    <button class="btn btn-primary" onclick="addToCart()">장바구니에 담기</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 대진대학교 벤처 졸업작품.</p>
        </div>
    </footer>

    <script>
        // 서버에서 받은 게임 데이터 표시하기
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const gameId = urlParams.get('gameId');

            if (gameId) {
                fetchGameDetails(gameId);
            }
        });

        async function fetchGameDetails(gameId) {
            try {
                const response = await fetch(`https://ludorium.store/api/user/game/${gameId}`);
                if (!response.ok) {
                    throw new Error('게임 데이터를 불러오는데 문제가 발생했습니다.');
                }
                const game = await response.json();
                renderGameDetails(game);
            } catch (error) {
                console.error('Error fetching game details:', error);
            }
        }

        function renderGameDetails(game) {
            document.getElementById('gameName').innerText = game.gameName;
            document.getElementById('gameCategory').innerText = `카테고리: ${game.categoryName}`;
            document.getElementById('gameImage').src = game.gameImageUrl || 'https://via.placeholder.com/150';
            document.getElementById('gameDescription').innerText = game.description || '설명이 없습니다.';
            document.getElementById('releaseDate').innerText = `출시일: ${game.releaseDate}`;
            document.getElementById('publisher').innerText = `배급사: ${game.publisher}`;

            if (game.originalPrice === game.discountPrice) {
                if (game.discountPrice === 0) {
                    document.getElementById('priceInfo').innerText = '무료';
                } else {
                    document.getElementById('priceInfo').innerText = `가격: ₩ ${game.discountPrice}`;
                }
            } else {
                document.getElementById('priceInfo').innerHTML = `
                    정상가: <s>₩ ${game.originalPrice}</s><br>
                    판매가: ₩ ${game.discountPrice} (${game.discountPercentage || 0}%)
                `;
            }
        }

        function addToCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const gameId = new URLSearchParams(window.location.search).get('gameId');
            if (!gameId) return;

            const existingGame = cart.find(item => item.id === gameId);
            if (!existingGame) {
                cart.push({ id: gameId });
                localStorage.setItem('cart', JSON.stringify(cart));
                if (confirm('장바구니에 담겼습니다. 장바구니로 이동하시겠습니까?')) {
                    window.location.href = 'cart.html';
                }
            } else {
                alert('이미 장바구니에 담긴 상품입니다.');
            }
        }
    </script>
</body>
</html>
