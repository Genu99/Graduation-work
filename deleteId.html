<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameForge - íšŒì› íƒˆí‡´</title>
    <link rel="stylesheet" href="deleteId.css" />
</head>
<body>
    <div id="header"></div>

    <nav>
     <ul class="menu">
        <li><a href="mypage.html">ë‚´ì •ë³´</a></li>
        <li><a href="info.html">ì •ë³´ìˆ˜ì •</a></li>
        <li><a href="modpwd.html">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a></li>
        <li><a href="order.html">ì£¼ë¬¸ë‚´ì—­</a></li>
        <li><a href="review.html">ë‚´ê°€ì“´ë¦¬ë·°</a></li>
        <li><a href="deleteId.html">íšŒì›íƒˆí‡´</a></li>
</ul>
    </nav>

    <p>íƒˆí‡´ë¥¼ ì›í•˜ì‹œë©´ "íšŒì› íƒˆí‡´"ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
    <input type="text" id="withdraw-input" placeholder="íšŒì› íƒˆí‡´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
    <button id="withdraw-btn" disabled>íƒˆí‡´</button>

     <!-- ìµœê·¼ ë³¸ ê²Œì„ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ (ë‹ë³´ê¸° ë²„íŠ¼ ìœ„ì— ê³ ì •) -->
    <button id="recent-games-btn" class="circular-btn fixed-btn recent-fixed-btn">ğŸ‘</button> <!-- ëˆˆ ì•„ì´ì½˜ì„ ì›í˜• ë²„íŠ¼ì— ë„£ìŒ -->

    <!-- íŒì—…ì„ ì—¬ëŠ” ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ì•„ë˜ ê³ ì •) -->
    <button id="open-popup-btn" class="circular-btn fixed-btn">ğŸ”</button> <!-- ë‹ë³´ê¸° ì•„ì´ì½˜ì„ ì›í˜• ë²„íŠ¼ì— ë„£ìŒ -->

    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header').innerHTML = data;
                    checkLoginStatus(); // í—¤ë” ë¡œë“œ í›„ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
                    const logoutButton = document.getElementById('logout-btn');
                    if (logoutButton) {
                        logoutButton.addEventListener('click', logout);
                    }
                })
                .catch(error => console.error('í—¤ë” ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error));

            // ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
            if (!localStorage.getItem('token')) {
                alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”');
                window.location.href = 'login.html';
            }
        });

        // ì…ë ¥ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.getElementById('withdraw-input').addEventListener('input', function() {
            const inputText = this.value;
            const withdrawButton = document.getElementById('withdraw-btn');

            // "íšŒì›íƒˆí‡´"ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
            if (inputText === 'íšŒì› íƒˆí‡´') {
                withdrawButton.disabled = false; // ë²„íŠ¼ í™œì„±í™”
            } else {
                withdrawButton.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”
            }
        });

        // íƒˆí‡´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.getElementById('withdraw-btn').addEventListener('click', function() {
            const token = getAuthToken();
            if (!token) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            fetch('https://ludorium.store/api/user/mypage', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('íšŒì›íƒˆí‡´ ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
            })
            .then(data => {
                // ì„±ê³µì ìœ¼ë¡œ ìš”ì²­ì´ ì™„ë£Œëœ ê²½ìš° ì²˜ë¦¬í•  ë¡œì§
                alert('íšŒì›íƒˆí‡´ ìš”ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.log(data); // ì„œë²„ì˜ ì‘ë‹µ ë°ì´í„° í™•ì¸
                // íƒˆí‡´ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = 'login.html';
            })
            .catch(error => {
                // ì—ëŸ¬ ì²˜ë¦¬
                console.error('Error:', error);
                alert('íšŒì›íƒˆí‡´ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        });

        // í† í°ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ ì •ì˜
        function getAuthToken() {
            return localStorage.getItem('token');
        }
        // íŒì—…ì°½ì„ ì—´ê³  í† í°ì„ ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜
        function openPopupWithToken() {
            const token = localStorage.getItem('token');
            if (!token) {
                console.error('í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.');
                return;
            }
            const popupUrl = `https://gameforge-ai-server.streamlit.app/?token=${token}`;
            const popupWindow = window.open(popupUrl, 'PopupWindow', 'width=600,height=600');
            if (!popupWindow || popupWindow.closed || typeof popupWindow.closed === 'undefined') {
                alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
            }
        }

        // ìµœê·¼ ë³¸ ê²Œì„ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
        function goToRecentGames() {
            window.location.href = 'recentGames.html';
        }

        // ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.getElementById('open-popup-btn').addEventListener('click', openPopupWithToken);
        document.getElementById('recent-games-btn').addEventListener('click', goToRecentGames);
    </script>
</body>
</html>
