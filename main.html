<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Forge - Main</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100&display=swap" rel="stylesheet">
</head>
<body>
    <!-- í—¤ë” ìë¦¬ í‘œì‹œì -->
    <div id="header-placeholder"></div>

    <div class="banner-slider">
        <div class="slides">
            <div class="slide">
                <img src="https://genu99.github.io/Graduation-work/images/core_keeeper.jpg" alt="core keeper" onerror="this.src='https://genu99.github.io/Graduation-work/images/placeholder.jpg';" />
            </div>
            <div class="slide">
                <img src="https://genu99.github.io/Graduation-work/images/eternal_return.jpg" alt="eternal return" onerror="this.src='https://genu99.github.io/Graduation-work/images/placeholder.jpg';" />
            </div>
            <div class="slide">
                <img src="https://genu99.github.io/Graduation-work/images/once_human.jpg" alt="once human" onerror="this.src='https://genu99.github.io/Graduation-work/images/placeholder.jpg';" />
            </div>
            <div class="slide">
                <img src="https://genu99.github.io/Graduation-work/images/60_seconds.jpg" alt="60 seconds" onerror="this.src='https://genu99.github.io/Graduation-work/images/placeholder.jpg';" />
            </div>
        </div>
        <div class="controls">
            <span class="material-symbols-outlined prev">arrow_back_ios</span>
            <span class="material-symbols-outlined next">arrow_forward_ios</span>
        </div>
    </div>

    <main>
        <section class="content">
            <div class="search-bar">
                <input type="text" placeholder="ìŠ¤íƒ€ë“€ë°¸ë¦¬ì˜ ìµœê·¼ ì—…ë°ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!" class="search-input">
                <button class="search-btn">ê²€ìƒ‰</button>
            </div>

            <!-- ì´ë‹¬ì˜ ì¶”ì²œ ê²Œì„ -->
            <section class="featured-games">
                <h2>ì´ë‹¬ì˜ íƒ‘4 ì¸ê¸°ê²Œì„</h2>
                <div class="game-grid" id="top-popular-games">
                    <!-- ê²Œì„ ì¹´ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </section>

            <!-- ì´ë‹¬ì˜ ì‹ ì‘ ê²Œì„ -->
            <section class="discounted-games">
                <h2>ì´ë‹¬ì˜ íƒ‘4 ì‹ ì‘ê²Œì„</h2>
                <div class="game-grid" id="top-new-games">
                    <!-- ê²Œì„ ì¹´ë“œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </section>
        </section>

        <!-- ìµœê·¼ ë³¸ ê²Œì„ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ (ë‹ë³´ê¸° ë²„íŠ¼ ìœ„ì— ê³ ì •) -->
        <button id="recent-games-btn" class="circular-btn fixed-btn recent-fixed-btn">ğŸ‘</button> <!-- ëˆˆ ì•„ì´ì½˜ì„ ì›í˜• ë²„íŠ¼ì— ë„£ìŒ -->

        <!-- íŒì—…ì„ ì—¬ëŠ” ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ì•„ë˜ ê³ ì •) -->
        <button id="open-popup-btn" class="circular-btn fixed-btn">ğŸ”</button> <!-- ë‹ë³´ê¸° ì•„ì´ì½˜ì„ ì›í˜• ë²„íŠ¼ì— ë„£ìŒ -->
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; ëŒ€ì§„ëŒ€í•™êµ ë²¤ì²˜ ì¡¸ì—…ì‘í’ˆ.</p>
        </div>
    </footer>

    <!-- auth.js ì¶”ê°€ - í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰ -->
    <script src="auth.js"></script>
    <script>
        const serverUrl = 'https://ludorium.store';

        // ì´ë‹¬ì˜ íƒ‘4 ì¸ê¸°ê²Œì„ ê°€ì ¸ì˜¤ê¸°
        async function fetchTopPopularGames() {
            try {
                const response = await fetch(`${serverUrl}/api/user/game/popular`);
                if (!response.ok) {
                    throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.');
                }
                const result = await response.json();
                renderGames(result.data.slice(0, 4), 'top-popular-games');
            } catch (error) {
                console.error('ì´ë‹¬ì˜ ì¸ê¸° ê²Œì„ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }

        // ì´ë‹¬ì˜ íƒ‘4 ì‹ ì‘ê²Œì„ ê°€ì ¸ì˜¤ê¸°
        async function fetchTopNewGames() {
            try {
                const response = await fetch(`${serverUrl}/api/user/game/new`);
                if (!response.ok) {
                    throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.');
                }
                const result = await response.json();
                renderGames(result.data.slice(0, 4), 'top-new-games');
            } catch (error) {
                console.error('ì´ë‹¬ì˜ ì‹ ì‘ ê²Œì„ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }

        // ê²Œì„ ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜
        function renderGames(games, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            games.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                gameCard.innerHTML = `
                    <a href="gameDetail.html?gameId=${game.gameId}">
                        <img src="${game.gameImageUrl || 'https://genu99.github.io/Graduation-work/images/placeholder.jpg'}" alt="${game.gameName}">
                        <p>${game.gameName}</p>
                    </a>
                `;
                container.appendChild(gameCard);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        document.addEventListener("DOMContentLoaded", function() {
            fetchTopPopularGames();
            fetchTopNewGames();
        });

        // íŒì—…ì°½ì„ ì—´ê³  í† í°ì„ ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜
        function openPopupWithToken() {
            // localStorageì—ì„œ í† í° ê°€ì ¸ì˜¤ê¸°
            const token = localStorage.getItem('token');

            // í† í°ì´ ì—†ëŠ” ê²½ìš° ì˜ˆì™¸ ì²˜ë¦¬
            if (!token) {
                console.error('í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.');
                return;
            }

            // íŒì—…ì°½ìœ¼ë¡œ ì´ë™í•  URL
            const popupUrl = `https://gameforge-ai-server.streamlit.app/?token=${token}`;

            // ìƒˆ ì°½ ì—´ê¸°
            const popupWindow = window.open(popupUrl, 'PopupWindow', 'width=600,height=600');

            if (!popupWindow || popupWindow.closed || typeof popupWindow.closed === 'undefined') {
                alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.getElementById('open-popup-btn').addEventListener('click', openPopupWithToken);

        // ìµœê·¼ ë³¸ ê²Œì„ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
        function goToRecentGames() {
            window.location.href = 'recentGames.html';
        }

        // ìµœê·¼ ë³¸ ê²Œì„ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.getElementById('recent-games-btn').addEventListener('click', goToRecentGames);
    </script>

</body>
</html>
