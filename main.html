<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Forge - Main</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="top-nav">
            <div class="logo">
                <a href="main.html">Game Forge</a> <!-- main 페이지로 이동 -->
            </div>
            <nav>
                <ul class="main-menu">
                    <li><a href="store.html">상점</a></li>
                    <li><a href="mypage.html">마이페이지</a></li>
                    <li><a href="community.html">자유게시판</a></li>
                    <li><a href="support.html">지원</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <span id="welcome-message"></span> <!-- 환영 메시지 추가 -->
                <a href="login.html" class="login-btn" id="login-btn">로그인</a> <!-- login.html로 이동 -->
                <button id="logout-btn" style="display:none;" onclick="logout()">로그아웃</button> <!-- 로그아웃 버튼 -->
            </div>
        </div>
        <div class="sub-nav">
            <ul class="submenu">
                <li>내 상점</li>
                <li>최근에 본 제품</li>
                <li>내 태그</li>
                <li>추천 제품</li>
                <li>카테고리 검색</li>
                <li>장르별 검색</li>
            </ul>
        </div>
    </header>

    <div class="banner-slider">
        <div class="slides">
            <div class="slide">
                <img src="./images/core_keeeper.jpg" alt="core keeper" />
            </div>
            <div class="slide">
                <img src="./images/eternal_return.jpg" alt="eternal return" />
            </div>
            <div class="slide">
                <img src="./images/once_human.jpg" alt="once human" />
            </div>
            <div class="slide">
                <img src="./images/60_seconds.jpg" alt="60 seconds" />
            </div>
        </div>
        <div class="controls">
            <span class="material-symbols-outlined prev">arrow_back_ios</span>
            <span class="material-symbols-outlined next">arrow_forward_ios</span>
        </div>
    </div>

    <main>
        <section class="content">
            <div class="search-bar">
                <input type="text" placeholder="스타듀밸리의 최근 업데이트를 확인하세요!" class="search-input">
                <button class="search-btn">검색</button>
            </div>

            <!-- 이달의 추천 게임 -->
            <section class="featured-games">
                <h2>이달의 추천게임</h2>
                <div class="game-grid">
                    <div class="game-card">
                        <a href="eternal_return.html">
                            <img src="./images/eternal_return.jpg" alt="Eternal Return">
                        <p>Eternal Return</p>
                    </div>
                    <div class="game-card">
                        <a href="The_sims4.html">
                            <img src="./images/sims.jpg" alt="The Sims4">
                        <p>The Sims4</p>
                    </div>
                    <div class="game-card">
                        <a href="stardew_valley.html">
                            <img src="./images/stardew_valley.jpg" alt="Stardew Valley">
                        <p>Stardew Valley</p>
                    </div>
                    <div class="game-card">
                        <a href="core_keeper.html">
                            <img src="./images/core_keeeper.jpg" alt="Core Keeper">
                        <p>Core Keeper</p>
                    </div>
                </div>
            </section>

            <!-- 이달의 할인 게임 -->
            <section class="discounted-games">
                <h2>이달의 할인게임</h2>
                <div class="game-grid">
                    <div class="game-card">
                        <img src="./images/battlegrounds.jpg" alt="Battlegrounds">
                        <p>Battlegrounds</p>
                    </div>
                    <div class="game-card">
                        <img src="./images/astroneer.jpg" alt="Astroneer">
                        <p>Astroneer</p>
                    </div>
                    <div class="game-card">
                        <img src="./images/60_seconds.jpg" alt="60 Seconds">
                        <p>60 Seconds!</p>
                    </div>
                    <div class="game-card">
                        <img src="./images/once_human.jpg" alt="Once Human">
                        <p>Once Human</p>
                    </div>
                </div>
            </section>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 대진대학교 벤처 졸업작품.</p>
        </div>
    </footer>

    <script>
        // JWT 토큰 디코딩 함수 (Base64 디코딩)
        function decodeJWT(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        // 로그인 상태 확인 함수
        function checkLoginStatus() {
            const token = localStorage.getItem('token'); // localStorage에서 토큰 가져오기
            const nickname = localStorage.getItem('nickname'); // localStorage에서 닉네임 가져오기

            const welcomeMessage = document.getElementById('welcome-message');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');

            if (token && nickname) {
                welcomeMessage.innerText = `환영합니다, ${nickname}님!`;
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
            } else {
                welcomeMessage.innerText = '';
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
            }
        }

        // 로그아웃 처리 함수
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('nickname');
            checkLoginStatus();
        }

        // OAuth 로그인 시 URL에서 토큰을 추출하여 저장
        function getTokenFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('access');
            if (token) {
                localStorage.setItem('token', token);
                const decodedToken = decodeJWT(token);
                localStorage.setItem('nickname', decodedToken.nickname);
                checkLoginStatus();
            }
        }

        // 페이지 로드 시 로그인 상태 확인
        window.onload = function() {
            checkLoginStatus();
            getTokenFromUrl();
        };
    </script>
</body>
</html>
